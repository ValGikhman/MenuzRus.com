@model MenuzRus.Models.DesignerModel
@using Services
<link href="@Url.Content("~/Content/designer.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/jquery.colpick.css")" rel="stylesheet" />
<script src="@Url.Content("~/Scripts/jquery/jquery.colpick.js")"></script>
<script src="@Url.Content("~/Scripts/itemProduct.js")"></script>
<script src="@Url.Content("~/Scripts/designer.js")"></script>
<div class="well container container-designer shadow">
    <div class="modal-header main-header">
        <h2>@Model.CategoryType.ToString() designer</h2>
    </div>

    <div id="default" class="clearfix">
        <div class="pull-right">
            <button id="btnNewCategory" type="button" class="btn btn-primary btn-md shadow" data-toggle="modal" onclick="javascript:editCategory(0)">New category</button>
            <button id="btnNewItem" type="button" class="noshow btn btn-primary btn-md shadow" data-toggle="modal" onclick="javascript:editItem(0)">New item</button>
        </div>
    </div>

    <div id="panel" class="page-designer shadow">
        @if (Model.Categories != null) {
            <table class="table navbar-inverse" style="margin-bottom: -1px; border-radius: 6px;">
                <thead style="color: #fff">
                    <tr>
                        <th style="width: 4%"></th>
                        <th style="width: 2%"><span class="glyphicon glyphicon-picture"></span></th>
                        <th style="width: 30%">Name</th>
                        <th style="width: 33%">Description</th>
                        <th style="width: 9%">Price</th>
                        <th style="width: 4%"></th>
                        <th>Actions</th>
                    </tr>
                </thead>
            </table>
            <div class="bodycontainer scrollable">
                <table class="table">
                    <tbody>
                        @foreach (Category category in Model.Categories.ToList()) {
                            String selector = String.Format(".items_{0}", category.id);
                            <tr class="categoryRow">
                                <td style="width: 4%">
                                    <span class="glyphicon glyphicon-plus pointer" onclick="javascript:collapseCategory(this, '@selector');"></span>
                                </td>
                                <td style="width: 2%">
                                    @if (!String.IsNullOrEmpty(@category.ImageUrl)) {
                                        <span id="popover" class="glyphicon glyphicon-picture" data-toggle="popover" data-content='<img src="@Url.Content(String.Format("~/Images/Menus/{0}/Categories/{1}?{2}", Model.MyCompany.id, category.ImageUrl, Guid.NewGuid().ToString("N")))" class="media-object image" />'></span>
                                    }
                                </td>
                                <td style="width: 30%">
                                    @if (!String.IsNullOrEmpty(category.Name)) {
                                        <div class="category" data-value="@category.id">
                                            @category.Name
                                        </div>
                                    }
                                </td>
                                <td style="width: 31%">
                                    @if (!String.IsNullOrEmpty(@category.Description)) {
                                        <div class="categoryDescription">@category.Description</div>
                                    }
                                </td>
                                <td style="width: 8%"></td>
                                <td style="width: 10%"></td>
                                <td>
                                    <div class="btn-group">
                                        <button id="editCategory" type="button" class="btn btn-info" onclick="javascript:editCategory(@category.id)"><span class="glyphicon glyphicon-pencil"></span></button>
                                        <button id="deleteCategory" type="button" class="btn btn-danger" onclick="javascript:deleteCategory(@category.id)"><span class="glyphicon glyphicon-trash"></span></button>
                                    </div>
                                </td>
                            </tr>
                                    if (category.Items != null && !String.IsNullOrEmpty(category.Name)) {
                                        foreach (Item item in category.Items) {
                                            String classname = String.Format("items_{0}", category.id);
                            <tr class="@classname noshow">
                                <td></td>
                                <td>
                                    @if (!String.IsNullOrEmpty(@item.ImageUrl)) {
                                        <span id="popover" class="glyphicon glyphicon-picture pointer" data-toggle="popover" data-content='<img src="@Url.Content(String.Format("~/Images/Menus/{0}/Items/{1}?{2}", Model.MyCompany.id, item.ImageUrl, Guid.NewGuid().ToString("N")))" class="media-object image" />'></span>
                                    }
                                </td>
                                <td>
                                    @if (!String.IsNullOrEmpty(item.Name)) {
                                        <div class="item" data-value="@item.id">
                                            @item.Name
                                        </div>
                                    }
                                </td>
                                <td>
                                    @if (!String.IsNullOrEmpty(item.Description)) {
                                        <div class="itemDescription">@item.Description </div>
                                    }
                                </td>

                                <td>
                                    @if (item.ItemPrices != null) {
                                        Decimal price = (Decimal)item.ItemPrices.OrderByDescending(m => m.DateCreated).Take(1).Select(m => m.Price).FirstOrDefault();
                                        if (price != 0) {
                                        <div class="itemPrice pull-right">$@price</div>
                                        }
                                    }
                                </td>
                                <td></td>
                                <td>
                                    <div class="btn-group">
                                        <button id="editItrem" type="button" class="btn btn-info" onclick="javascript:editItem(@item.id)"><span class="glyphicon glyphicon-pencil"></span></button>
                                        <button id="deletItem" type="button" class="btn btn-danger" onclick="javascript:deleteItem(@item.id)"><span class="glyphicon glyphicon-trash"></span></button>
                                        <button id="assosiateItem" type="button" class="btn btn-success" onclick="javascript:associateItem(@item.id)"><span class="glyphicon glyphicon-transfer"></span></button>
                                    </div>
                                </td>
                            </tr>
                                        }
                                    }
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>
@Html.HiddenFor(m => m.CategoryType)